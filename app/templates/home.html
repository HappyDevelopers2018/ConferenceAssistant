<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/now-ui-kit.css">
    <link rel="stylesheet" type="text/css" href="assets/css/home.css">
    <script src="assets/js/jquery.min.js"></script>

    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="assets/js/cookie.js" type="text/javascript"></script>

    <title>学术会议网站</title>
</head>
<script type="text/javascript">
    function getNum(){
        console.log("into getNum")
        $.ajax({

            url:"/getConfernum",
            type:"GET",
            datatype: 'json',
            success:function (data) {
                console.log("in getConfernum")

                console.log(data["num"])
                $("#conferNum").html(data['num'])
            },
            error:function () {
                console.log("error when getConfernum")
            }
        })
    }
    $(document).ready(function() {
        getNum()
        $.ajax({
            url: "/getNewConference",
            type: "GET",
            datatype: 'json',
            success: function (data) {
                data = JSON.parse(data)
                $("#conferid").empty();
                length = data.length
                var conferdiv
                for (var i = 0;i<length;i++)
                {
                    id = data[i]["id"]
                    // console.log(id)
                    hrefstr = "/ConferenceIndex?id="+id;
                    // window.location.href ="/ConferenceIndex?id="+ data.result;
                    conferdiv=" <div class=\"confer shadow \" >\n" +
                        "                        <a href="+hrefstr+" ><h3>"+data[i]['conferenceName']+"</h3></a>\n" +
                        "                        <div class=\"c-info\">\n" +
                        "                            <span class=\"mr-2\"><img src=\"assets/images/loc.png\" class=\"loc\">"+data[i]['location']+"</span>\n" +
                        "                            <span><span><img src=\"assets/images/date.png\" class=\"i-date\">"+data[i]['startTime']+"</span> - <span>"+data[i]['endTime']+"</span></span></span>\n" +
                        "                            <p class=\"mb-0 pb-0\"><img src=\"assets/images/department.png\" class=\"i-date\">主办方 <span>"+data[i]['organizer']+"</span></p>\n" +
                        "                        </div>\n" +
                        "                    </div>"
                    $("#conferid").append(conferdiv);

                }

            },
            error: function () {
                alert("error in ready !")
            }
        })



    })
</script>
<script>
    function logout() {
        var t=new Date();
	    t.setTime(0);
	    document.cookie="name=;expires="+t.toGMTString()+";path=/";
	    document.cookie="id=;expires="+t.toGMTString()+";path=/";
        name="";
	    $('#login').html("登录");
	    window.location.href="index";
    }
    function login() {
        name=getUserNameByCookie();
        console.log(name)
        if(!name){
            window.location.href="login";

        }
        else{
            $('#login').html(name);
        }
    }
    function getName() {
        name=getUserNameByCookie();
        console.log(name);
        if(name){
            $('#login').html(name);
        }
    }
    function submitConf() {
        identity=getUserIdentityByCookie();
        if(identity==3){
            window.location.href='process1'
        }
        else if(identity==1){
            alert('您没有权限创建会议，请注册为机构用户')
        }
        else if(identity==2){
            alert('该单位用户申请正在审核中')
        }
        else if(identity==4){
            alert('该单位用户申请被拒绝')
        }
    }
    function search() {
        var searchKey=$('#searchKey').val();
        console.log(searchKey);
        window.location.href='search?kw='+searchKey
    }

</script>
<body onload="getName()">
<nav class="navbar navbar-expand-lg " style="background-color: #2b579a">
    <div class="container">
        <div class="navbar-translate">
            <a class="navbar-brand" href="#pablo">
                Conference
            </a>
        </div>




        <div class="collapse navbar-collapse justify-content-end" id="navigation">
            <form class="nav-form"  >
                <div style="position: relative;">

            <span >
                <input type="text" class="search form-control-nav" placeholder="搜索会议" id="searchKey" name="searchKey">
                <button class="cha" onclick="search()">搜索</button>
            </span>
                </div>
            </form>

            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="#pablo">
                        主页
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="conference" onclick="submitConf()">发布会议</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#pablo">我的</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="login" onclick="login()" style="text-transform: none">登录</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " onclick="logout()">登出</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div>
<div class="banner-container">
<div class="banner">
    <div class="clear"></div>
    <div class="container" >
        <div class="row" style="position: relative">
            <div class="col-xl-9 mx-auto">
            <h1 class="mb-5" style="font-size: 3rem; color: #244683">学 术 会 议</h1>
            </div>
        </div>
        <div class="row" >
            <button class="btn-lg btn-primary" onclick=submitConf()
                    style="text-align: center; margin: 0 auto; background-color: #2b579a;font-size: 20px">
                创建会议</button>
        </div>





</div>

</div>


</div>


    <div class="information">
        <div class="container">
            <div class="mt-3"></div>
            <div class="row">

                <div class="col-sm-9 blog-main" id="conferid">





                </div>

                <div class="col-sm-3 blog-sidebar">
                    <div class="information-l skas">
                        <div class="ddlin">
                            <h3>会议总数</h3>
                            <img src="assets/images/mp_mini.jpg" style="width: 100% ;">
                            <span id="conferNum" style="font-size: 20px; color: red">200</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



</div>

</body>
</html>